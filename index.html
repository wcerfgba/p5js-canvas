<meta name="viewport" content="width=device-width, initial-scale=1">
<div id="cupboard">
  <textarea id="sauce">
Wanderer = function () {
  this._x = Math.random() - 0.5;
  this._y = Math.random() - 0.5;
  this._dx = Math.random() - 0.5;
  this._dy = Math.random() - 0.5;
  this.color = `rgb(0, ${Math.floor(Math.random() * 255)}, ${Math.floor(Math.random() * 255)})`;
};

Wanderer.prototype.tick = function () {
  this._x += this._dx;
  this._y += this._dy;
  const wallX = -1 * 0.5 * Math.sign(this._x) * log(abs(this._x) + 1);
  const wallY = -1 * 0.5 * Math.sign(this._y) * log(abs(this._y) + 1);
  const centerX = 1 * 0.5 * Math.sign(this._x) * log(1 - abs(this._x) + 1);
  const centerY = 1 * 0.5 * Math.sign(this._y) * log(1 - abs(this._y) + 1);
  this._dx += wallX + centerX;
  this._dy += wallY + centerY;
};

Wanderer.prototype.x = function () {
  return (this._x + 1) * (windowWidth / 2);
};

Wanderer.prototype.y = function () {
  return (this._y + 1) * (windowHeight / 2);
};

wanderers = [];

for (let i = 0; i < 200; i++) {
  wanderers[i] = new Wanderer();
}

function draw() {
  for (let i = 0; i < wanderers.length; i++) {
    const wanderer = wanderers[i];
    wanderer.tick();
    dragTrail(wanderer.x(), wanderer.y(), wanderer.color);
  }
}

function dragTrail(x, y, col) {
  fill(col);
  noStroke();
  ellipse(x, y, 1, 1);
}
  </textarea>
</div>
<div id="canvas"></div>
<script id="pot"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.33.0/codemirror.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.33.0/mode/javascript/javascript.min.js" integrity="sha256-AZSIPzjrc6unqannlAp/r264kf3nZGOOdPRcgYJ0J0c=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.6.0/p5.js"></script>
<script>
  function setup() {
    createCanvas(displayWidth, displayHeight).parent('canvas');
  }

  const jar = CodeMirror.fromTextArea(
    document.querySelector('#sauce'), {
      mode: 'javascript'
  });

  thawSauce();

  jar.on('blur', cookSauce);

  cookSauce();

  function cookSauce() {
    document.querySelector('#pot').remove();
    const newPot = document.createElement('script');
    newPot.text = jar.getValue();
    newPot.id = 'pot';
    document.body.appendChild(newPot);
    freezeSauce();
  }

  function freezeSauce() {
    window.location.hash = btoa(jar.getValue());
  }

  function thawSauce() {
    if (
      typeof window.location.hash !== 'string' ||
      window.location.hash.charAt(0) !== '#'
    ) {
      return;
    }
    jar.setValue(atob(window.location.hash.slice(1)));
  }
</script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.33.0/codemirror.css">
<style>
  body {
    margin: 0;
  }

  #canvas {
    position: absolute;
    overflow: hidden;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 1;
  }

  #cupboard {
    position: absolute;
    top: 0;
    left: 0;
    width: 30rem;
    max-height: 100%;
    height: 100%;
    z-index: 2;
    resize: both;
    overflow: scroll;
    background: #fcfcfcf0;
  }

  .CodeMirror {
    width: 100%;
    height: 100%;
    background: none;
  }

  .CodeMirror-scroll {
    margin: 0;
    padding: 0;
  }
</style>